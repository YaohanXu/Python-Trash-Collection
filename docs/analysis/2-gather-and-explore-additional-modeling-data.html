<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Gather and Explore Additional Modeling Data – Final Project_Neve and Yaohan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-9ea0a49c779b6fc496fdb60b6bf00fef.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-9b6c00cfdd9f97392670a293d2d1e528.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../analysis/index.html">Data Analysis</a></li><li class="breadcrumb-item"><a href="../analysis/2-gather-and-explore-additional-modeling-data.html">Gather and Explore Additional Modeling Data</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/course-icon.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://yaohanxu.github.io/JS-Assign3/" title="Personal Website" class="quarto-navigation-tool px-1" aria-label="Personal Website"><i class="bi bi-globe"></i></a>
    <a href="https://github.com/YaohanXu" title="Yaohan Xu GitHub" class="quarto-navigation-tool px-1" aria-label="Yaohan Xu GitHub"><i class="bi bi-github"></i></a>
    <a href="https://www.instagram.com/yaohan_xu/" title="Yaohan Xu Instagram" class="quarto-navigation-tool px-1" aria-label="Yaohan Xu Instagram"><i class="bi bi-instagram"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Team Members</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/0a-create-311-parquet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Create 311 Parquet</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/0b-trim-additional-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Trim Additional Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/1-process-and-visualize-sanitation-request-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Process and Visualize Sanitation Request Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/2-gather-and-explore-additional-modeling-data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Gather and Explore Additional Modeling Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/3-gather-and-explore-additional-prediction-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gather and Explore Additional Prediction Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/4-model-building-validation-and-prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model Building, Validation, and Prediction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/5-application-and-optimization-recommendation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Use 2024 Predictions for DSNY Trash Collection Optimization</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conclusion</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#set-up" id="toc-set-up" class="nav-link active" data-scroll-target="#set-up"><span class="header-section-number">1</span> Set Up</a></li>
  <li><a href="#load-dsny-boundary-and-complaint-data-2022-and-2023" id="toc-load-dsny-boundary-and-complaint-data-2022-and-2023" class="nav-link" data-scroll-target="#load-dsny-boundary-and-complaint-data-2022-and-2023"><span class="header-section-number">2</span> Load DSNY Boundary and Complaint Data (2022 and 2023)</a>
  <ul class="collapse">
  <li><a href="#load-dsny-boundary" id="toc-load-dsny-boundary" class="nav-link" data-scroll-target="#load-dsny-boundary"><span class="header-section-number">2.1</span> Load DSNY Boundary</a></li>
  <li><a href="#load-complaint-data" id="toc-load-complaint-data" class="nav-link" data-scroll-target="#load-complaint-data"><span class="header-section-number">2.2</span> Load Complaint Data</a></li>
  </ul></li>
  <li><a href="#lagged-data-gathering" id="toc-lagged-data-gathering" class="nav-link" data-scroll-target="#lagged-data-gathering"><span class="header-section-number">3</span> Lagged Data Gathering</a>
  <ul class="collapse">
  <li><a href="#gather-2022-acs-5-year-data" id="toc-gather-2022-acs-5-year-data" class="nav-link" data-scroll-target="#gather-2022-acs-5-year-data"><span class="header-section-number">3.1</span> Gather 2022 ACS 5-year data</a></li>
  <li><a href="#gather-2022-nyc-restaurants-violation-data" id="toc-gather-2022-nyc-restaurants-violation-data" class="nav-link" data-scroll-target="#gather-2022-nyc-restaurants-violation-data"><span class="header-section-number">3.2</span> Gather 2022 NYC Restaurants Violation Data</a></li>
  <li><a href="#gather-2022-nyc-other-311-data" id="toc-gather-2022-nyc-other-311-data" class="nav-link" data-scroll-target="#gather-2022-nyc-other-311-data"><span class="header-section-number">3.3</span> Gather 2022 NYC Other 311 Data</a></li>
  <li><a href="#gather-2022-weather-data" id="toc-gather-2022-weather-data" class="nav-link" data-scroll-target="#gather-2022-weather-data"><span class="header-section-number">3.4</span> Gather 2022 Weather Data</a></li>
  </ul></li>
  <li><a href="#forecasted-non-lagged-data-gathering" id="toc-forecasted-non-lagged-data-gathering" class="nav-link" data-scroll-target="#forecasted-non-lagged-data-gathering"><span class="header-section-number">4</span> Forecasted (Non-Lagged) Data Gathering</a>
  <ul class="collapse">
  <li><a href="#gather-litter-basket-data" id="toc-gather-litter-basket-data" class="nav-link" data-scroll-target="#gather-litter-basket-data"><span class="header-section-number">4.1</span> Gather Litter Basket Data</a></li>
  <li><a href="#gather-traffic-data" id="toc-gather-traffic-data" class="nav-link" data-scroll-target="#gather-traffic-data"><span class="header-section-number">4.2</span> Gather Traffic Data</a></li>
  <li><a href="#add-a-holiday-column" id="toc-add-a-holiday-column" class="nav-link" data-scroll-target="#add-a-holiday-column"><span class="header-section-number">4.3</span> Add a Holiday Column</a></li>
  <li><a href="#add-a-day-of-the-week-column" id="toc-add-a-day-of-the-week-column" class="nav-link" data-scroll-target="#add-a-day-of-the-week-column"><span class="header-section-number">4.4</span> Add a Day of the Week Column</a></li>
  <li><a href="#add-a-week-column" id="toc-add-a-week-column" class="nav-link" data-scroll-target="#add-a-week-column"><span class="header-section-number">4.5</span> Add a Week Column</a></li>
  </ul></li>
  <li><a href="#merge-lagged-and-forecasted-variables-data" id="toc-merge-lagged-and-forecasted-variables-data" class="nav-link" data-scroll-target="#merge-lagged-and-forecasted-variables-data"><span class="header-section-number">5</span> Merge Lagged and Forecasted Variables Data</a></li>
  <li><a href="#visualizing-and-exploring-variables" id="toc-visualizing-and-exploring-variables" class="nav-link" data-scroll-target="#visualizing-and-exploring-variables"><span class="header-section-number">6</span> Visualizing and Exploring Variables</a>
  <ul class="collapse">
  <li><a href="#correlation-plot-across-all-variables" id="toc-correlation-plot-across-all-variables" class="nav-link" data-scroll-target="#correlation-plot-across-all-variables"><span class="header-section-number">6.1</span> Correlation Plot Across All Variables</a></li>
  <li><a href="#time-series-of-complaint-count" id="toc-time-series-of-complaint-count" class="nav-link" data-scroll-target="#time-series-of-complaint-count"><span class="header-section-number">6.2</span> Time series of complaint count</a></li>
  <li><a href="#map-of-complaint-count-in-relation-to-highly-correlated-factors" id="toc-map-of-complaint-count-in-relation-to-highly-correlated-factors" class="nav-link" data-scroll-target="#map-of-complaint-count-in-relation-to-highly-correlated-factors"><span class="header-section-number">6.3</span> Map of Complaint Count in relation to highly-correlated factors</a></li>
  <li><a href="#chart-of-complaint-count-with-natural-factors" id="toc-chart-of-complaint-count-with-natural-factors" class="nav-link" data-scroll-target="#chart-of-complaint-count-with-natural-factors"><span class="header-section-number">6.4</span> Chart of Complaint Count with Natural Factors</a></li>
  </ul></li>
  <li><a href="#save-data-for-model-building" id="toc-save-data-for-model-building" class="nav-link" data-scroll-target="#save-data-for-model-building"><span class="header-section-number">7</span> Save Data for Model Building</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../analysis/index.html">Data Analysis</a></li><li class="breadcrumb-item"><a href="../analysis/2-gather-and-explore-additional-modeling-data.html">Gather and Explore Additional Modeling Data</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Gather and Explore Additional Modeling Data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>To support more strategic trash removal scheduling, our proposed tool leverages historical data and forecasted trends to provide insights into next year’s anticipated trash reporting incidents. This section compiles the following additional independent features hypothesized to correlate with trash complaint counts for year 2022-2023, which will be used as modeling data in the later sections.</p>
<ul>
<li><strong>sociodemographic factors</strong>: <code>median household income</code>, <code>share of non-white population</code>, <code>share of hispanic-latino population</code>, <code>poverty rate</code>, and <code>average household size</code>. The data is retrieved from 2018-2023 5-year American Community Survey using API. These factors are common indicators of low-income and minority communities, who may be prone to systematic disinvestment.</li>
<li><code>restaurant violation inspections</code>: Higher volumes of trash-related restaurant violation not only indicate lack of trash management, but also high human activities.</li>
<li><strong>other 311 requests</strong>: <code>derelict vehicles</code> and <code>graffiti</code> are also reported to DSNY and reflect poorly managed locations prone to trash dumping.</li>
<li><strong>weather</strong>: daily records of <code>average temperature</code>, <code>precipitation</code>, and <code>snow</code> is gathered, as these factors can exacerbate conditions of trash overflow, or impact human activities.</li>
<li><code>litter basket</code>: the distribution of litter basket likely have an impact on accessibility of waste disposal locations, hence impacting local sanitation conditions.</li>
<li><code>traffic (auto)</code>: the aggregated volume of road traffic in a neighborhood is an indicator of human activities and business vibrancy, thereby influencing the chance of trashing.</li>
<li><strong>unique days</strong>: <code>day of the week</code>, <code>week</code> and <code>holiday</code> indicate specific times of the week or year when human activities fluctuate. For instance, weekend evenings or holidays are more likely to involve social gatherings or food and drink-related activities, thereby increasing trash volumes.</li>
<li><code>lagged counts</code>: assuming that trashing trends exhibit similarities across adjacent years, the number of complaints on a specific date one year ago is considered to correlate with the count on the same date the following year.</li>
</ul>
<p>In the following steps, we approached the data gathering process into lagged data versus forcasted data, based on careful consideration of data availability and common release date.</p>
<section id="set-up" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="set-up"><span class="header-section-number">1</span> Set Up</h2>
<div id="c8335724-008b-4973-b512-b7951a6fe9ee" class="cell" data-tags="[]">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> osmnx <span class="im">as</span> ox</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cenpy</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pygris</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install hvplot</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> holoviews <span class="im">as</span> hv</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>hv.extension(<span class="st">'bokeh'</span>) </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datashader.colors <span class="im">import</span> viridis</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hvplot.pandas</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.wkt <span class="im">import</span> loads</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> MultiLineString</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.ops <span class="im">import</span> nearest_points</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install meteostat</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> meteostat <span class="im">import</span> Point, Daily, Stations</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install holidays</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> holidays</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Show all columns in dataframes</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_columns <span class="op">=</span> <span class="dv">999</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Hide warnings due to issue in shapely package </span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># See: https://github.com/shapely/shapely/issues/1345</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>np.seterr(invalid<span class="op">=</span><span class="st">"ignore"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="load-dsny-boundary-and-complaint-data-2022-and-2023" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="load-dsny-boundary-and-complaint-data-2022-and-2023"><span class="header-section-number">2</span> Load DSNY Boundary and Complaint Data (2022 and 2023)</h2>
<section id="load-dsny-boundary" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="load-dsny-boundary"><span class="header-section-number">2.1</span> Load DSNY Boundary</h3>
<div id="ed29a2c6-c81a-4789-990d-91406f498c12" class="cell" data-tags="[]" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>DSNY_boundary <span class="op">=</span> gpd.read_file(<span class="st">'data/1_DSNY_boundary_processed.geojson'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject to state plane</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>DSNY_boundary <span class="op">=</span> DSNY_boundary.to_crs(epsg<span class="op">=</span><span class="dv">2263</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="load-complaint-data" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="load-complaint-data"><span class="header-section-number">2.2</span> Load Complaint Data</h3>
<div id="d48636d5-d8cd-4a61-aa2b-e4968b740ac5" class="cell" data-tags="[]" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load 2022 data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>complaints_22 <span class="op">=</span> pd.read_parquet(<span class="st">'data/1_complaints_DSNY_full_2022.parquet'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="7333fd2d-dd61-47fd-b35b-d8a071b67b5b" class="cell" data-tags="[]" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load 2023 data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>complaints_23 <span class="op">=</span> pd.read_parquet(<span class="st">'data/1_complaints_DSNY_full_2023.parquet'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="77457d48-fc1c-4c6f-8a94-9dc80a29a9e7" class="cell" data-tags="[]" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert date to the right format</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>complaints_22[<span class="st">'Created Date'</span>] <span class="op">=</span> pd.to_datetime(complaints_22[<span class="st">'Created Date'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>complaints_23[<span class="st">'Created Date'</span>] <span class="op">=</span> pd.to_datetime(complaints_23[<span class="st">'Created Date'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="lagged-data-gathering" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="lagged-data-gathering"><span class="header-section-number">3</span> Lagged Data Gathering</h2>
<p>A key restriction to the model’s feasibility is availability of data. To predict an upcoming year’s trash removal taskforce scheduling, we will leverage the following data based on the previous years’ records, including: - <strong>sociodemographic factors</strong>: <code>median household income</code>, <code>share of non-white population</code>, <code>share of hispanic-latino population</code>, <code>poverty rate</code>, and <code>average household size</code> - <code>restaurant violation inspections</code> - <strong>other 311 requests</strong>: <code>derelict vehicles</code> and <code>graffiti</code> - <strong>weather</strong>: daily records of <code>average temperature</code>, <code>precipitation</code>, and <code>snow</code> - <code>lagged counts</code>: ie. Number of Complaints filed on 2022-01-01 will be used to predict for 2023-01-01, completed in Section 1</p>
<section id="gather-2022-acs-5-year-data" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="gather-2022-acs-5-year-data"><span class="header-section-number">3.1</span> Gather 2022 ACS 5-year data</h3>
<section id="data-gathering" class="level4" data-number="3.1.1">
<h4 data-number="3.1.1" class="anchored" data-anchor-id="data-gathering"><span class="header-section-number">3.1.1</span> Data Gathering</h4>
<div id="73aba665-5cce-4ea0-9c81-1a8decf64cd2" class="cell" data-tags="[]" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>variables <span class="op">=</span> [<span class="st">"NAME"</span>,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">"B19013_001E"</span>, <span class="co">#median hh income</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">"B01003_001E"</span>, <span class="co">#total pop</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"B03002_003E"</span>, <span class="co">#white alone</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"B03002_012E"</span>, <span class="co">#hispanic-latino total</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"B06012_002E"</span>, <span class="co">#poverty rate</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"B25010_001E"</span> <span class="co">#average hh size</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>acs <span class="op">=</span> cenpy.remote.APIConnection(<span class="st">"ACSDT5Y2022"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>NYC_county_code <span class="op">=</span> [<span class="st">"005"</span>, <span class="st">"047"</span>, <span class="st">"061"</span>, <span class="st">"081"</span>, <span class="st">"085"</span>]</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>NYC_code <span class="op">=</span> <span class="st">"36"</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>NYC_county_string <span class="op">=</span> <span class="st">","</span>.join(NYC_county_code)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>acs_vars <span class="op">=</span> acs.query(</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    cols<span class="op">=</span>variables,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    geo_unit<span class="op">=</span><span class="st">"tract:*"</span>,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    geo_filter<span class="op">=</span>{<span class="st">"state"</span>: NYC_code, <span class="st">"county"</span>: NYC_county_string},</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>acs_vars.rename(columns<span class="op">=</span>{</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B19013_001E"</span>: <span class="st">"Med_HH_Inc"</span>, </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B01003_001E"</span>: <span class="st">"Tot_Pop"</span>, </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B03002_003E"</span>: <span class="st">"White_Alone"</span>,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B03002_012E"</span>: <span class="st">"Hispanic_Latino"</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B06012_002E"</span>: <span class="st">"Poverty_Pop"</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B25010_001E"</span>: <span class="st">"Avg_HH_Size"</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to Numeric</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>exclude_cols<span class="op">=</span> [<span class="st">'NAME'</span>, <span class="st">'tract'</span>, <span class="st">'state'</span>, <span class="st">'county'</span>]</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>acs_vars.loc[:, <span class="op">~</span>acs_vars.columns.isin(exclude_cols)] <span class="op">=</span> (</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    acs_vars.loc[:, <span class="op">~</span>acs_vars.columns.isin(exclude_cols)]</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove invalid results</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>acs_vars <span class="op">=</span> acs_vars[</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    (acs_vars[<span class="st">'Med_HH_Inc'</span>] <span class="op">!=</span> <span class="op">-</span><span class="dv">666666666</span>) <span class="op">&amp;</span> </span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    (acs_vars[<span class="st">'Avg_HH_Size'</span>] <span class="op">!=</span> <span class="op">-</span><span class="dv">666666666</span>)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>acs_vars <span class="op">=</span> acs_vars.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate race/ethnicity share</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>acs_vars[<span class="st">'Pct_Non_White'</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> (acs_vars[<span class="st">'White_Alone'</span>] <span class="op">/</span> acs_vars[<span class="st">'Tot_Pop'</span>])) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>acs_vars[<span class="st">'Pct_Hispanic'</span>] <span class="op">=</span> (acs_vars[<span class="st">'Hispanic_Latino'</span>] <span class="op">/</span> acs_vars[<span class="st">'Tot_Pop'</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>acs_vars[<span class="st">'Poverty_Rate'</span>] <span class="op">=</span> (acs_vars[<span class="st">'Poverty_Pop'</span>] <span class="op">/</span> acs_vars[<span class="st">'Tot_Pop'</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify GEOID of the acs_vars data frame</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>acs_vars[<span class="st">"GEOID"</span>] <span class="op">=</span> (</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    acs_vars[<span class="st">"state"</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">2</span>) <span class="op">+</span>  </span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    acs_vars[<span class="st">"county"</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    acs_vars[<span class="st">"tract"</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">6</span>)</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="co"># select necessary columns</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>acs_vars <span class="op">=</span> acs_vars[[<span class="st">"GEOID"</span>, <span class="st">"Med_HH_Inc"</span>, <span class="st">"Pct_Non_White"</span>, <span class="st">"Pct_Hispanic"</span>, <span class="st">"Poverty_Rate"</span>, <span class="st">"Avg_HH_Size"</span>]]</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Get NYC tracts boundaries</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>NYC_tracts <span class="op">=</span> pygris.tracts(state<span class="op">=</span><span class="st">"36"</span>, county<span class="op">=</span>NYC_county_code, year<span class="op">=</span><span class="dv">2022</span>)</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge info with tract boundaries</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>acs_vars_tracts<span class="op">=</span> acs_vars.merge(NYC_tracts, on<span class="op">=</span><span class="st">"GEOID"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a><span class="co"># select necessary columns</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>acs_vars_tracts <span class="op">=</span> acs_vars_tracts[[<span class="st">"GEOID"</span>, <span class="st">"Med_HH_Inc"</span>, <span class="st">"Pct_Non_White"</span>, <span class="st">"Pct_Hispanic"</span>, <span class="st">"Poverty_Rate"</span>, <span class="st">"Avg_HH_Size"</span>,<span class="st">"geometry"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="join-acs-variables-with-dsny-boundaries" class="level4" data-number="3.1.2">
<h4 data-number="3.1.2" class="anchored" data-anchor-id="join-acs-variables-with-dsny-boundaries"><span class="header-section-number">3.1.2</span> Join ACS Variables with DSNY Boundaries</h4>
<div id="b3c61212-e555-4b33-80f9-7af3ec870bd5" class="cell" data-tags="[]" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate centroids of DSNY_boundary</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>DSNY_boundary[<span class="st">'centroid'</span>] <span class="op">=</span> DSNY_boundary.geometry.centroid</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>DSNY_centroids <span class="op">=</span> DSNY_boundary.set_geometry(<span class="st">'centroid'</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>DSNY_boundary <span class="op">=</span> DSNY_boundary.drop(columns<span class="op">=</span>[<span class="st">'centroid'</span>])</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure CRS matches between the two datasets</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>acs_vars_tracts <span class="op">=</span> gpd.GeoDataFrame(acs_vars_tracts, geometry<span class="op">=</span>acs_vars_tracts[<span class="st">'geometry'</span>], crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>acs_vars_tracts <span class="op">=</span> acs_vars_tracts.to_crs(DSNY_boundary.crs)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform spatial join to match centroids with ACS tract data</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_acs <span class="op">=</span> gpd.sjoin(DSNY_centroids, acs_vars_tracts, how<span class="op">=</span><span class="st">"left"</span>, predicate<span class="op">=</span><span class="st">"intersects"</span>).drop(columns<span class="op">=</span>[<span class="st">'index_right'</span>])</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_acs <span class="op">=</span> DSNY_boundary_with_acs.drop(columns<span class="op">=</span>[<span class="st">'centroid'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="join-acs-variables-with-complaints-data-by-district" class="level4" data-number="3.1.3">
<h4 data-number="3.1.3" class="anchored" data-anchor-id="join-acs-variables-with-complaints-data-by-district"><span class="header-section-number">3.1.3</span> Join ACS Variables with Complaints Data by District</h4>
<div id="9e823ba9-8d76-4f52-aacb-51b8546007f9" class="cell" data-tags="[]" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>complaints_22 <span class="op">=</span> (complaints_22.merge(DSNY_boundary_with_acs, on<span class="op">=</span><span class="st">"DSNY_ID"</span>, how<span class="op">=</span><span class="st">"left"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="gather-2022-nyc-restaurants-violation-data" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="gather-2022-nyc-restaurants-violation-data"><span class="header-section-number">3.2</span> Gather 2022 NYC Restaurants Violation Data</h3>
<p><em>Note: the data loaded is pre-processed in section “Trim Additional Data”.</em></p>
<section id="data-gathering-1" class="level4" data-number="3.2.1">
<h4 data-number="3.2.1" class="anchored" data-anchor-id="data-gathering-1"><span class="header-section-number">3.2.1</span> Data Gathering</h4>
<div id="00c9a958-8831-481e-916a-1d2c0091cc0d" class="cell" data-tags="[]" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>restaurant_violations <span class="op">=</span> pd.read_csv(<span class="st">"data/sanitation_related_restaurant_inspections.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="join-restaurant-violations-with-dsny-boundaries" class="level4" data-number="3.2.2">
<h4 data-number="3.2.2" class="anchored" data-anchor-id="join-restaurant-violations-with-dsny-boundaries"><span class="header-section-number">3.2.2</span> Join Restaurant Violations with DSNY Boundaries</h4>
<div id="da7a7113-7985-4258-8e61-b9ef74287804" class="cell" data-tags="[]" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert restaurant violations data to a GeoDataFrame</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>restaurant_violations <span class="op">=</span> restaurant_violations[[<span class="st">'CAMIS'</span>, <span class="st">'INSPECTION DATE'</span>, <span class="st">'Latitude'</span>, <span class="st">'Longitude'</span>]]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>restaurant_violations <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  restaurant_violations, geometry<span class="op">=</span>gpd.points_from_xy(restaurant_violations.Longitude, restaurant_violations.Latitude), crs<span class="op">=</span><span class="st">"EPSG:4326"</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>restaurant_violations <span class="op">=</span> restaurant_violations.to_crs(DSNY_boundary.crs)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform spatial join - identify which DSNY district the restaurant is associated with </span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_rv <span class="op">=</span> gpd.sjoin(restaurant_violations, DSNY_boundary, how<span class="op">=</span><span class="st">"right"</span>, predicate<span class="op">=</span><span class="st">"within"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Group violation inspections by district and date</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_rv <span class="op">=</span> (</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    DSNY_boundary_with_rv.groupby([<span class="st">'DSNY_ID'</span>, <span class="st">'INSPECTION DATE'</span>])[<span class="st">'CAMIS'</span>]</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    .nunique()</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_rv.rename(columns<span class="op">=</span>{<span class="st">'CAMIS'</span>: <span class="st">'Restaurant Inspection Count'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_rv.rename(columns<span class="op">=</span>{<span class="st">"INSPECTION DATE"</span>: <span class="st">"Created Date"</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="join-restaurant-violations-with-complaints-data-by-district-and-date" class="level4" data-number="3.2.3">
<h4 data-number="3.2.3" class="anchored" data-anchor-id="join-restaurant-violations-with-complaints-data-by-district-and-date"><span class="header-section-number">3.2.3</span> Join Restaurant Violations with Complaints Data by District and Date</h4>
<div id="d5eeb076-b235-4f7b-aabb-f4125ba082ff" class="cell" data-tags="[]" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join with complaints data 2022</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_rv[<span class="st">'Created Date'</span>] <span class="op">=</span> pd.to_datetime(DSNY_boundary_with_rv[<span class="st">'Created Date'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%m/</span><span class="sc">%d</span><span class="st">/%Y'</span>, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Join with the time series dataframe</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>complaints_22 <span class="op">=</span> complaints_22.merge(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    DSNY_boundary_with_rv,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span>[<span class="st">"Created Date"</span>, <span class="st">"DSNY_ID"</span>],  </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span>                       </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="gather-2022-nyc-other-311-data" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="gather-2022-nyc-other-311-data"><span class="header-section-number">3.3</span> Gather 2022 NYC Other 311 Data</h3>
<p><em>Note: The loaded datasets were pre-processed in section “Trim Additional Data”.</em></p>
<section id="data-gathering-2" class="level4" data-number="3.3.1">
<h4 data-number="3.3.1" class="anchored" data-anchor-id="data-gathering-2"><span class="header-section-number">3.3.1</span> Data Gathering</h4>
<div id="5f0e1466-9fb5-4001-9f9d-ba1fe223ac54" class="cell" data-tags="[]" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Derelict Vehicles</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>derelict_vehicles <span class="op">=</span> pd.read_parquet(<span class="st">"data/derelict_vehicles.parquet"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Graffiti</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>graffiti <span class="op">=</span> pd.read_parquet(<span class="st">"data/graffiti.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="join-other-311-data-with-dsny-boundaries" class="level4" data-number="3.3.2">
<h4 data-number="3.3.2" class="anchored" data-anchor-id="join-other-311-data-with-dsny-boundaries"><span class="header-section-number">3.3.2</span> Join Other 311 Data with DSNY Boundaries</h4>
<div id="a146836a-26d7-4d09-b3c7-cc7a159a1cd3" class="cell" data-tags="[]" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join derelict vehicles</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert derelict vehicles data to a GeoDataFrame</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>derelict_vehicles <span class="op">=</span> derelict_vehicles[[<span class="st">'Unique Key'</span>, <span class="st">'Created Date'</span>, <span class="st">'Latitude'</span>, <span class="st">'Longitude'</span>]]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>derelict_vehicles <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  derelict_vehicles, geometry<span class="op">=</span>gpd.points_from_xy(derelict_vehicles.Longitude, derelict_vehicles.Latitude), crs<span class="op">=</span><span class="st">"EPSG:4326"</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>derelict_vehicles <span class="op">=</span> derelict_vehicles.to_crs(DSNY_boundary.crs)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Perform spatial join</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_dv <span class="op">=</span> gpd.sjoin(derelict_vehicles, DSNY_boundary, how<span class="op">=</span><span class="st">"right"</span>, predicate<span class="op">=</span><span class="st">"within"</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group derelict vehicles by district and date</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_dv <span class="op">=</span> (</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    DSNY_boundary_with_dv.groupby([<span class="st">'DSNY_ID'</span>, <span class="st">'Created Date'</span>])[<span class="st">'Unique Key'</span>]</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    .nunique()</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_dv.rename(columns<span class="op">=</span>{<span class="st">'Unique Key'</span>: <span class="st">'Derelict Vehicle Count'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Join Graffiti</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert graffiti data to a GeoDataFrame</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>graffiti <span class="op">=</span> graffiti[[<span class="st">'Unique Key'</span>, <span class="st">'Created Date'</span>, <span class="st">'Latitude'</span>, <span class="st">'Longitude'</span>]]</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>graffiti <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  graffiti, geometry<span class="op">=</span>gpd.points_from_xy(graffiti.Longitude, graffiti.Latitude), crs<span class="op">=</span><span class="st">"EPSG:4326"</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>graffiti <span class="op">=</span> graffiti.to_crs(DSNY_boundary.crs)</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Perform spatial join</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_g <span class="op">=</span> gpd.sjoin(graffiti, DSNY_boundary, how<span class="op">=</span><span class="st">"right"</span>, predicate<span class="op">=</span><span class="st">"within"</span>)</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group graffiti by district and date</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_g <span class="op">=</span> (</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    DSNY_boundary_with_g.groupby([<span class="st">'DSNY_ID'</span>, <span class="st">'Created Date'</span>])[<span class="st">'Unique Key'</span>]</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    .nunique()</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_g.rename(columns<span class="op">=</span>{<span class="st">'Unique Key'</span>: <span class="st">'Graffiti Count'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="join-other-311-data-with-complaints-data-by-district-and-date" class="level4" data-number="3.3.3">
<h4 data-number="3.3.3" class="anchored" data-anchor-id="join-other-311-data-with-complaints-data-by-district-and-date"><span class="header-section-number">3.3.3</span> Join Other 311 Data with Complaints Data by District and Date</h4>
<div id="20a39679-24fe-42c1-9e05-c365d87330d2" class="cell" data-tags="[]" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure dates are in datetime format</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_dv[<span class="st">'Created Date'</span>] <span class="op">=</span> pd.to_datetime(DSNY_boundary_with_dv[<span class="st">'Created Date'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_g[<span class="st">'Created Date'</span>] <span class="op">=</span> pd.to_datetime(DSNY_boundary_with_g[<span class="st">'Created Date'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Join derelict vehicle records with the time series dataframe</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>complaints_22 <span class="op">=</span> complaints_22.merge(</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    DSNY_boundary_with_dv,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span>[<span class="st">"Created Date"</span>, <span class="st">"DSNY_ID"</span>],  </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span>                       </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Join graffiti records with the time series dataframe</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>complaints_22 <span class="op">=</span> complaints_22.merge(</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    DSNY_boundary_with_g,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span>[<span class="st">"Created Date"</span>, <span class="st">"DSNY_ID"</span>],  </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span>                       </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="gather-2022-weather-data" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="gather-2022-weather-data"><span class="header-section-number">3.4</span> Gather 2022 Weather Data</h3>
<section id="data-gathering-3" class="level4" data-number="3.4.1">
<h4 data-number="3.4.1" class="anchored" data-anchor-id="data-gathering-3"><span class="header-section-number">3.4.1</span> Data Gathering</h4>
<div id="fb7071cf-b051-4b77-adba-9d14d4c52075" class="cell" data-tags="[]" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define time range for weather data</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>weather_start <span class="op">=</span> datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>weather_end <span class="op">=</span> datetime(<span class="dv">2022</span>, <span class="dv">12</span>, <span class="dv">31</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Location weather data station</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>stations <span class="op">=</span> Stations()</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>stations <span class="op">=</span> stations.nearby(<span class="fl">40.7128</span>, <span class="op">-</span><span class="fl">74.0060</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>station <span class="op">=</span> stations.fetch()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="146aa420-6210-4354-90c4-ae0e8be8684b" class="cell" data-tags="[]" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Location weather data station</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>stations <span class="op">=</span> Stations()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>stations <span class="op">=</span> stations.nearby(<span class="fl">40.7128</span>, <span class="op">-</span><span class="fl">74.0060</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>station <span class="op">=</span> stations.fetch()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick station</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>JFK <span class="op">=</span> station[station[<span class="st">'name'</span>] <span class="op">==</span> <span class="st">"John F. Kennedy Airport"</span>]</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Gather data</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>weather_data <span class="op">=</span> Daily(JFK, weather_start, weather_end)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>weather_data <span class="op">=</span> weather_data.fetch()</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Reset the index to make 'time' a regular column</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>weather_data <span class="op">=</span> weather_data.reset_index()</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'time' to datetime format</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>weather_data[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(weather_data[<span class="st">'time'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Trim temperature, precipitation and snow data</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>weather_cols <span class="op">=</span> [<span class="st">'time'</span>, <span class="st">'tavg'</span>, <span class="st">'prcp'</span>, <span class="st">'snow'</span>]</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>weather_data <span class="op">=</span> weather_data.loc[:, weather_data.columns.isin(weather_cols)]</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>weather_data.rename(columns<span class="op">=</span>{</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tavg"</span>: <span class="st">"avg_temp"</span>,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prcp"</span>: <span class="st">"precipitation"</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="join-weather-data-with-complaints-data-by-date" class="level4" data-number="3.4.2">
<h4 data-number="3.4.2" class="anchored" data-anchor-id="join-weather-data-with-complaints-data-by-date"><span class="header-section-number">3.4.2</span> Join Weather Data with Complaints Data by Date</h4>
<div id="92f3a136-9e1f-4900-b1e1-3728faf85d46" class="cell" data-tags="[]" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>complaints_22 <span class="op">=</span> complaints_22.merge(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    weather_data,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">"Created Date"</span>,  </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span><span class="st">"time"</span>,        </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span>             </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>complaints_22 <span class="op">=</span> complaints_22.drop(columns<span class="op">=</span>[<span class="st">'time'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="73d5b1ff-f0ca-4565-8aa9-cef15ac53746" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>complaints_22</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DSNY_ID</th>
<th data-quarto-table-cell-role="th">Created Date</th>
<th data-quarto-table-cell-role="th">Complaint Count</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">GEOID</th>
<th data-quarto-table-cell-role="th">Med_HH_Inc</th>
<th data-quarto-table-cell-role="th">Pct_Non_White</th>
<th data-quarto-table-cell-role="th">Pct_Hispanic</th>
<th data-quarto-table-cell-role="th">Poverty_Rate</th>
<th data-quarto-table-cell-role="th">Avg_HH_Size</th>
<th data-quarto-table-cell-role="th">Restaurant Inspection Count</th>
<th data-quarto-table-cell-role="th">Derelict Vehicle Count</th>
<th data-quarto-table-cell-role="th">Graffiti Count</th>
<th data-quarto-table-cell-role="th">avg_temp</th>
<th data-quarto-table-cell-role="th">precipitation</th>
<th data-quarto-table-cell-role="th">snow</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>BKN011_A</td>
<td>2022-01-01</td>
<td>0.0</td>
<td>MULTIPOLYGON (((995020.254 205025.197, 995260....</td>
<td>36047056100</td>
<td>146250.0</td>
<td>30.224904</td>
<td>13.878223</td>
<td>5.951728</td>
<td>2.11</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>10.1</td>
<td>31.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BKN011_A</td>
<td>2022-01-02</td>
<td>0.0</td>
<td>MULTIPOLYGON (((995020.254 205025.197, 995260....</td>
<td>36047056100</td>
<td>146250.0</td>
<td>30.224904</td>
<td>13.878223</td>
<td>5.951728</td>
<td>2.11</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>11.5</td>
<td>0.8</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>BKN011_A</td>
<td>2022-01-03</td>
<td>1.0</td>
<td>MULTIPOLYGON (((995020.254 205025.197, 995260....</td>
<td>36047056100</td>
<td>146250.0</td>
<td>30.224904</td>
<td>13.878223</td>
<td>5.951728</td>
<td>2.11</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1.2</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BKN011_A</td>
<td>2022-01-04</td>
<td>0.0</td>
<td>MULTIPOLYGON (((995020.254 205025.197, 995260....</td>
<td>36047056100</td>
<td>146250.0</td>
<td>30.224904</td>
<td>13.878223</td>
<td>5.951728</td>
<td>2.11</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-3.8</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>BKN011_A</td>
<td>2022-01-05</td>
<td>0.0</td>
<td>MULTIPOLYGON (((995020.254 205025.197, 995260....</td>
<td>36047056100</td>
<td>146250.0</td>
<td>30.224904</td>
<td>13.878223</td>
<td>5.951728</td>
<td>2.11</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2.5</td>
<td>7.4</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">222645</td>
<td>SI038_E</td>
<td>2022-12-27</td>
<td>1.0</td>
<td>MULTIPOLYGON (((921213.717 128503.472, 921135....</td>
<td>36085024800</td>
<td>131146.0</td>
<td>19.098458</td>
<td>16.152629</td>
<td>6.58363</td>
<td>2.94</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-0.9</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">222646</td>
<td>SI038_E</td>
<td>2022-12-28</td>
<td>0.0</td>
<td>MULTIPOLYGON (((921213.717 128503.472, 921135....</td>
<td>36085024800</td>
<td>131146.0</td>
<td>19.098458</td>
<td>16.152629</td>
<td>6.58363</td>
<td>2.94</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2.1</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">222647</td>
<td>SI038_E</td>
<td>2022-12-29</td>
<td>0.0</td>
<td>MULTIPOLYGON (((921213.717 128503.472, 921135....</td>
<td>36085024800</td>
<td>131146.0</td>
<td>19.098458</td>
<td>16.152629</td>
<td>6.58363</td>
<td>2.94</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3.7</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">222648</td>
<td>SI038_E</td>
<td>2022-12-30</td>
<td>0.0</td>
<td>MULTIPOLYGON (((921213.717 128503.472, 921135....</td>
<td>36085024800</td>
<td>131146.0</td>
<td>19.098458</td>
<td>16.152629</td>
<td>6.58363</td>
<td>2.94</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>5.4</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">222649</td>
<td>SI038_E</td>
<td>2022-12-31</td>
<td>0.0</td>
<td>MULTIPOLYGON (((921213.717 128503.472, 921135....</td>
<td>36085024800</td>
<td>131146.0</td>
<td>19.098458</td>
<td>16.152629</td>
<td>6.58363</td>
<td>2.94</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>7.9</td>
<td>6.9</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>222650 rows × 16 columns</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="forecasted-non-lagged-data-gathering" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="forecasted-non-lagged-data-gathering"><span class="header-section-number">4</span> Forecasted (Non-Lagged) Data Gathering</h2>
<p>The following steps gather and process forecasted variables based on historic records. Since spatial factors (e.g., location of litter baskets, wider vs.&nbsp;narrower roads) tend to remain relatively constant over time, we projected counts and averages from past year(s) as forecasts for 2023 (the prediction year).</p>
<ul>
<li><code>litter basket</code>: the distribution of litter basket likely have an impact on accessibility of waste disposal locations, hence impacting local sanitation conditions.</li>
<li><code>traffic (auto)</code>: the aggregated volume of road traffic in a neighborhood is an indicator of human activities and business vibrancy, thereby influencing the chance of trashing.</li>
</ul>
<p>source: - DSNY Litter Basket, NYC Open Data [https://data.cityofnewyork.us/dataset/DSNY-Litter-Basket-Map-/d6m8-cwh9] - Traffic Volume Counts, NYC Open Data [https://data.cityofnewyork.us/Transportation/Traffic-Volume-Counts/btm5-ppia/about_data]</p>
<section id="gather-litter-basket-data" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="gather-litter-basket-data"><span class="header-section-number">4.1</span> Gather Litter Basket Data</h3>
<section id="data-gathering-4" class="level4" data-number="4.1.1">
<h4 data-number="4.1.1" class="anchored" data-anchor-id="data-gathering-4"><span class="header-section-number">4.1.1</span> Data Gathering</h4>
<div id="5df222d4-1a52-4b29-a461-98220ba6c09a" class="cell" data-tags="[]" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>litter_basket <span class="op">=</span> pd.read_csv(<span class="st">"data/DSNY_Litter_Basket_Inventory.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="join-litter-basket-data-with-dsny-boundaries" class="level4" data-number="4.1.2">
<h4 data-number="4.1.2" class="anchored" data-anchor-id="join-litter-basket-data-with-dsny-boundaries"><span class="header-section-number">4.1.2</span> Join Litter Basket Data with DSNY Boundaries</h4>
<div id="e60936e3-783a-46ab-a47c-9ed5f72981be" class="cell" data-tags="[]" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>litter_basket[<span class="st">'point'</span>] <span class="op">=</span> litter_basket[<span class="st">'point'</span>].<span class="bu">apply</span>(loads)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>litter_basket_gdf <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    litter_basket, </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    geometry<span class="op">=</span>litter_basket[<span class="st">'point'</span>],</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span><span class="st">"EPSG:4326"</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>litter_basket_gdf <span class="op">=</span> litter_basket_gdf.to_crs(DSNY_boundary.crs)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_baskets <span class="op">=</span> gpd.sjoin(litter_basket_gdf, DSNY_boundary, how<span class="op">=</span><span class="st">"right"</span>, predicate<span class="op">=</span><span class="st">"within"</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># count number of baskets by DSNY units</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_baskets <span class="op">=</span> (</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    DSNY_boundary_with_baskets.groupby([<span class="st">'DSNY_ID'</span>])[<span class="st">'BASKETID'</span>]</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    .nunique()</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_baskets.rename(columns<span class="op">=</span>{<span class="st">'BASKETID'</span>: <span class="st">'Basket Count'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="join-litter-basket-data-with-complaints-data-by-district" class="level4" data-number="4.1.3">
<h4 data-number="4.1.3" class="anchored" data-anchor-id="join-litter-basket-data-with-complaints-data-by-district"><span class="header-section-number">4.1.3</span> Join Litter Basket Data with Complaints Data by District</h4>
<div id="353b6f97-7c28-4f74-aa90-fea47170233d" class="cell" data-tags="[]" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>complaints_23 <span class="op">=</span> (complaints_23.merge(DSNY_boundary_with_baskets, on<span class="op">=</span><span class="st">"DSNY_ID"</span>, how<span class="op">=</span><span class="st">"left"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="gather-traffic-data" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="gather-traffic-data"><span class="header-section-number">4.2</span> Gather Traffic Data</h3>
<section id="data-gathering-5" class="level4" data-number="4.2.1">
<h4 data-number="4.2.1" class="anchored" data-anchor-id="data-gathering-5"><span class="header-section-number">4.2.1</span> Data Gathering</h4>
<div id="67dd2938-f6b8-41f2-8c16-94bfb8227a4d" class="cell" data-tags="[]" data-execution_count="22">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load street network in New York using OpenStreetMap API</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>place_name <span class="op">=</span> <span class="st">"New York, USA"</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> ox.graph_from_place(place_name, network_type<span class="op">=</span><span class="st">"drive"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert street network graph to GeoDataFrame</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>edges <span class="op">=</span> ox.graph_to_gdfs(G, nodes<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>edges <span class="op">=</span> edges.dropna(subset<span class="op">=</span>[<span class="st">'name'</span>, <span class="st">'length'</span>, <span class="st">'geometry'</span>])</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the list of street names to a single string</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>edges[<span class="st">'name'</span>] <span class="op">=</span> edges[<span class="st">'name'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">', '</span>.join(x) <span class="cf">if</span> <span class="bu">isinstance</span>(x, <span class="bu">list</span>) <span class="cf">else</span> x)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge edge geometry with the same name</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>edges_grouped <span class="op">=</span> edges.groupby(<span class="st">'name'</span>).agg({</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'geometry'</span>: <span class="kw">lambda</span> x: MultiLineString([geom <span class="cf">for</span> geom <span class="kw">in</span> x]),</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'length'</span>: <span class="st">'sum'</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the edge grouped data to GeoDataFrame</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>edges_grouped <span class="op">=</span> gpd.GeoDataFrame(edges_grouped, geometry<span class="op">=</span><span class="st">'geometry'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="d78d2829-860f-4f25-8f94-7eff592ac95b" class="cell" data-tags="[]" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load traffic count data</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>traffic_count <span class="op">=</span> pd.read_csv(<span class="st">"./data/Traffic_Volume_Counts.csv"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total traffic count for each segment per count date</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>retain_columns <span class="op">=</span> [<span class="st">'ID'</span>, <span class="st">'SegmentID'</span>, <span class="st">'Roadway Name'</span>, <span class="st">'From'</span>, <span class="st">'To'</span>, <span class="st">'Direction'</span>, <span class="st">'Date'</span>]</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>sum_columns <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> traffic_count.columns <span class="cf">if</span> col <span class="kw">not</span> <span class="kw">in</span> retain_columns]</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>traffic_count[<span class="st">'count'</span>] <span class="op">=</span> traffic_count[sum_columns].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>traffic_count <span class="op">=</span> traffic_count.drop(columns<span class="op">=</span>sum_columns)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the average daily traffic on each road</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>traffic_count_grouped <span class="op">=</span> traffic_count.groupby(<span class="st">'Roadway Name'</span>).agg({ <span class="st">'count'</span>: <span class="st">'mean'</span> }).reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="1e0d7803-9157-4407-9970-403f3008b932" class="cell" data-tags="[]" data-execution_count="24">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>traffic_count_grouped[<span class="st">'Roadway Name'</span>] <span class="op">=</span> traffic_count_grouped[<span class="st">'Roadway Name'</span>].<span class="bu">str</span>.lower()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>edges_grouped[<span class="st">'name'</span>] <span class="op">=</span> edges_grouped[<span class="st">'name'</span>].<span class="bu">str</span>.lower()</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># merge the average daily traffic volume to street network</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>traffic_merged <span class="op">=</span> pd.merge(</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    traffic_count_grouped,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    edges_grouped,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">'Roadway Name'</span>,  </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span><span class="st">'name'</span>,        </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'inner'</span>             </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>traffic_merged <span class="op">=</span> traffic_merged.drop(columns<span class="op">=</span>[<span class="st">'name'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="join-traffic-data-with-dsny-boundaries" class="level4" data-number="4.2.2">
<h4 data-number="4.2.2" class="anchored" data-anchor-id="join-traffic-data-with-dsny-boundaries"><span class="header-section-number">4.2.2</span> Join Traffic Data with DSNY Boundaries</h4>
<div id="7a95b10e-400d-4296-ae53-16ecf4996a5e" class="cell" data-tags="[]" data-execution_count="25">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert traffic_merged to a GeoDataFrame object with correct state plane projection</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>traffic_merged <span class="op">=</span> gpd.GeoDataFrame(traffic_merged, geometry<span class="op">=</span><span class="st">'geometry'</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>traffic_merged <span class="op">=</span> traffic_merged.set_crs(<span class="st">"EPSG:4326"</span>) </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>traffic_merged <span class="op">=</span> traffic_merged.to_crs(DSNY_boundary.crs)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a spatial join to assign roads to DSNY units</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_traffic <span class="op">=</span> gpd.sjoin(traffic_merged, DSNY_boundary, how<span class="op">=</span><span class="st">"inner"</span>, predicate<span class="op">=</span><span class="st">"intersects"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="52fb7df0-8863-47be-bcce-4487a6ce5a38" class="cell" data-tags="[]" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>DSNY_boundary_with_traffic <span class="op">=</span> DSNY_boundary_with_traffic.groupby(<span class="st">'DSNY_ID'</span>).agg({ <span class="st">'count'</span>: <span class="st">'mean'</span> }).reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="join-traffic-data-with-complaints-data-by-district" class="level4" data-number="4.2.3">
<h4 data-number="4.2.3" class="anchored" data-anchor-id="join-traffic-data-with-complaints-data-by-district"><span class="header-section-number">4.2.3</span> Join Traffic Data with Complaints Data by District</h4>
<div id="6341c35e-a5e7-4170-ae65-aec15be653eb" class="cell" data-tags="[]" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>complaints_23 <span class="op">=</span> (complaints_23.merge(DSNY_boundary_with_traffic, on<span class="op">=</span><span class="st">"DSNY_ID"</span>, how<span class="op">=</span><span class="st">"left"</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>complaints_23.rename(columns<span class="op">=</span>{<span class="st">'count'</span>: <span class="st">'Traffic Count'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="add-a-holiday-column" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="add-a-holiday-column"><span class="header-section-number">4.3</span> Add a Holiday Column</h3>
<div id="c1f350cb-a402-4ccb-9a70-ed9a5875cecd" class="cell" data-tags="[]" data-execution_count="28">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>complaints_23[<span class="st">'Holiday'</span>] <span class="op">=</span> complaints_23[<span class="st">'Created Date'</span>].isin(holidays.US())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="add-a-day-of-the-week-column" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="add-a-day-of-the-week-column"><span class="header-section-number">4.4</span> Add a Day of the Week Column</h3>
<div id="d5cf2bd7-556b-48f0-8874-e187b47bac70" class="cell" data-tags="[]" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>complaints_23[<span class="st">'Day of Week'</span>] <span class="op">=</span> complaints_23[<span class="st">'Created Date'</span>].dt.day_name()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="add-a-week-column" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="add-a-week-column"><span class="header-section-number">4.5</span> Add a Week Column</h3>
<div id="7712232f-f2d0-4fca-b45f-0f58cd70bb2c" class="cell" data-tags="[]" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>complaints_23[<span class="st">'Week'</span>] <span class="op">=</span> complaints_23[<span class="st">'Created Date'</span>].dt.isocalendar().week</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="b8e05be2-6a4c-4c0c-a21a-e585438aac2c" class="cell" data-tags="[]" data-execution_count="31">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>complaints_23</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DSNY_ID</th>
<th data-quarto-table-cell-role="th">Created Date</th>
<th data-quarto-table-cell-role="th">Complaint Count</th>
<th data-quarto-table-cell-role="th">Basket Count</th>
<th data-quarto-table-cell-role="th">Traffic Count</th>
<th data-quarto-table-cell-role="th">Holiday</th>
<th data-quarto-table-cell-role="th">Day of Week</th>
<th data-quarto-table-cell-role="th">Week</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>BKN011_A</td>
<td>2023-01-01</td>
<td>0.0</td>
<td>47</td>
<td>9794.421906</td>
<td>False</td>
<td>Sunday</td>
<td>52</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BKN011_A</td>
<td>2023-01-02</td>
<td>0.0</td>
<td>47</td>
<td>9794.421906</td>
<td>False</td>
<td>Monday</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>BKN011_A</td>
<td>2023-01-03</td>
<td>0.0</td>
<td>47</td>
<td>9794.421906</td>
<td>False</td>
<td>Tuesday</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BKN011_A</td>
<td>2023-01-04</td>
<td>0.0</td>
<td>47</td>
<td>9794.421906</td>
<td>False</td>
<td>Wednesday</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>BKN011_A</td>
<td>2023-01-05</td>
<td>0.0</td>
<td>47</td>
<td>9794.421906</td>
<td>False</td>
<td>Thursday</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">222645</td>
<td>SI038_E</td>
<td>2023-12-27</td>
<td>1.0</td>
<td>6</td>
<td>13195.713605</td>
<td>False</td>
<td>Wednesday</td>
<td>52</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">222646</td>
<td>SI038_E</td>
<td>2023-12-28</td>
<td>0.0</td>
<td>6</td>
<td>13195.713605</td>
<td>False</td>
<td>Thursday</td>
<td>52</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">222647</td>
<td>SI038_E</td>
<td>2023-12-29</td>
<td>0.0</td>
<td>6</td>
<td>13195.713605</td>
<td>False</td>
<td>Friday</td>
<td>52</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">222648</td>
<td>SI038_E</td>
<td>2023-12-30</td>
<td>0.0</td>
<td>6</td>
<td>13195.713605</td>
<td>False</td>
<td>Saturday</td>
<td>52</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">222649</td>
<td>SI038_E</td>
<td>2023-12-31</td>
<td>0.0</td>
<td>6</td>
<td>13195.713605</td>
<td>False</td>
<td>Sunday</td>
<td>52</td>
</tr>
</tbody>
</table>

<p>222650 rows × 8 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="merge-lagged-and-forecasted-variables-data" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="merge-lagged-and-forecasted-variables-data"><span class="header-section-number">5</span> Merge Lagged and Forecasted Variables Data</h2>
<p>All 2022 variables are advanced by one year to align with the exact same dates in the 2023 data. Specifically, trash-related complaint counts from 2022 serve as lagged data for 2023. This enables the prediction of trash complaint patterns in advance, using data available by the end of the previous year.</p>
<div id="cc3b8e2d-bb47-4099-94d5-66796ebb7fe6" class="cell" data-tags="[]" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform 2022 data Created Date to Match Date</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>complaints_22[<span class="st">'Match Date'</span>] <span class="op">=</span> complaints_22[<span class="st">'Created Date'</span>] <span class="op">+</span> pd.DateOffset(years<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>complaints_22 <span class="op">=</span> complaints_22.drop(columns<span class="op">=</span>[<span class="st">'Created Date'</span>])</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename Count column in 2022 data</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>complaints_22.rename(columns<span class="op">=</span>{<span class="st">"Complaint Count"</span>: <span class="st">"Complaint Count Lag"</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="6bd13066-328b-4eff-bc50-00e9a682ead5" class="cell" data-tags="[]" data-execution_count="33">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the two dataset </span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>DSNY_final <span class="op">=</span> complaints_22.merge(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    complaints_23,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span>[<span class="st">'DSNY_ID'</span>, <span class="st">'Match Date'</span>],</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span>[<span class="st">'DSNY_ID'</span>, <span class="st">'Created Date'</span>],</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'right'</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>DSNY_final <span class="op">=</span> DSNY_final.drop(columns<span class="op">=</span>[<span class="st">'Match Date'</span>, <span class="st">'GEOID'</span>])</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>DSNY_final.rename(columns<span class="op">=</span>{<span class="st">'Created Date'</span>: <span class="st">'Date'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>DSNY_final.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DSNY_ID</th>
<th data-quarto-table-cell-role="th">Complaint Count Lag</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">Med_HH_Inc</th>
<th data-quarto-table-cell-role="th">Pct_Non_White</th>
<th data-quarto-table-cell-role="th">Pct_Hispanic</th>
<th data-quarto-table-cell-role="th">Poverty_Rate</th>
<th data-quarto-table-cell-role="th">Avg_HH_Size</th>
<th data-quarto-table-cell-role="th">Restaurant Inspection Count</th>
<th data-quarto-table-cell-role="th">Derelict Vehicle Count</th>
<th data-quarto-table-cell-role="th">Graffiti Count</th>
<th data-quarto-table-cell-role="th">avg_temp</th>
<th data-quarto-table-cell-role="th">precipitation</th>
<th data-quarto-table-cell-role="th">snow</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Complaint Count</th>
<th data-quarto-table-cell-role="th">Basket Count</th>
<th data-quarto-table-cell-role="th">Traffic Count</th>
<th data-quarto-table-cell-role="th">Holiday</th>
<th data-quarto-table-cell-role="th">Day of Week</th>
<th data-quarto-table-cell-role="th">Week</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>BKN011_A</td>
<td>0.0</td>
<td>MULTIPOLYGON (((995020.254 205025.197, 995260....</td>
<td>146250.0</td>
<td>30.224904</td>
<td>13.878223</td>
<td>5.951728</td>
<td>2.11</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>10.1</td>
<td>31.0</td>
<td>0.0</td>
<td>2023-01-01</td>
<td>0.0</td>
<td>47</td>
<td>9794.421906</td>
<td>False</td>
<td>Sunday</td>
<td>52</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BKN011_A</td>
<td>0.0</td>
<td>MULTIPOLYGON (((995020.254 205025.197, 995260....</td>
<td>146250.0</td>
<td>30.224904</td>
<td>13.878223</td>
<td>5.951728</td>
<td>2.11</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>11.5</td>
<td>0.8</td>
<td>0.0</td>
<td>2023-01-02</td>
<td>0.0</td>
<td>47</td>
<td>9794.421906</td>
<td>False</td>
<td>Monday</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>BKN011_A</td>
<td>1.0</td>
<td>MULTIPOLYGON (((995020.254 205025.197, 995260....</td>
<td>146250.0</td>
<td>30.224904</td>
<td>13.878223</td>
<td>5.951728</td>
<td>2.11</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1.2</td>
<td>0.0</td>
<td>0.0</td>
<td>2023-01-03</td>
<td>0.0</td>
<td>47</td>
<td>9794.421906</td>
<td>False</td>
<td>Tuesday</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BKN011_A</td>
<td>0.0</td>
<td>MULTIPOLYGON (((995020.254 205025.197, 995260....</td>
<td>146250.0</td>
<td>30.224904</td>
<td>13.878223</td>
<td>5.951728</td>
<td>2.11</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-3.8</td>
<td>0.0</td>
<td>0.0</td>
<td>2023-01-04</td>
<td>0.0</td>
<td>47</td>
<td>9794.421906</td>
<td>False</td>
<td>Wednesday</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>BKN011_A</td>
<td>0.0</td>
<td>MULTIPOLYGON (((995020.254 205025.197, 995260....</td>
<td>146250.0</td>
<td>30.224904</td>
<td>13.878223</td>
<td>5.951728</td>
<td>2.11</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2.5</td>
<td>7.4</td>
<td>0.0</td>
<td>2023-01-05</td>
<td>0.0</td>
<td>47</td>
<td>9794.421906</td>
<td>False</td>
<td>Thursday</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="visualizing-and-exploring-variables" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="visualizing-and-exploring-variables"><span class="header-section-number">6</span> Visualizing and Exploring Variables</h2>
<p>We created a series of plots and maps below to explore the association between the dependent variable (complaint count of the predicted year) and the independent variables.</p>
<section id="correlation-plot-across-all-variables" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="correlation-plot-across-all-variables"><span class="header-section-number">6.1</span> Correlation Plot Across All Variables</h3>
<p>The correlation plot used a binary palette to reveal the correlation between independent variable and all numeric variables. The legend indicates that 1.0 (deep red) indicates perfect positive correlation, 0 (neutral grey) indicates no correlation, and -1.0 (deep blue) indicates perfect negative correlation.</p>
<p>The chart suggests that some correlation exists between trash-related complaint count of 2023 and the following variables: - Count of complaints in the previous year (<code>Complaint Count Lag</code>) - Share of non-white population in the previous year (<code>Pct_Non_White</code>) - Share of Hispanic-Latino population in the previous year (<code>Pct_Hispanic</code>) - Poverty rate in the previous year (<code>Poverty_Rate</code>) - Average household size in the previous year (<code>Avg_HH_Size</code>) - Count of Restaurant Inspections in the previous year (<code>Restaurant Inspection Count</code>) - Count of derelict vehicles in the previous year (<code>Derelict Vehicle Count</code>) - Average daily temperature in the previous year (<code>avg_temp</code>) - Projected basket count within the DSNY boundary (<code>basket count</code>)</p>
<div id="c524b686-baaf-4113-8135-c50bb023e446" class="cell" data-tags="[]" data-execution_count="34">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>DSNY_final <span class="op">=</span> DSNY_final.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>DSNY_final[<span class="st">'Week'</span>] <span class="op">=</span> DSNY_final[<span class="st">'Week'</span>].astype(<span class="bu">str</span>) </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> DSNY_final.corr()</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>plt.imshow(correlation_matrix, cmap<span class="op">=</span><span class="st">"coolwarm"</span>, interpolation<span class="op">=</span><span class="st">"nearest"</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>plt.xticks(<span class="bu">range</span>(correlation_matrix.shape[<span class="dv">1</span>]), correlation_matrix.columns, rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>plt.yticks(<span class="bu">range</span>(correlation_matrix.shape[<span class="dv">1</span>]), correlation_matrix.columns)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>plt.colorbar(label<span class="op">=</span><span class="st">"Correlation Coefficient"</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Correlation Grid (Gradient Colors)"</span>)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>FutureWarning: The default value of numeric_only in DataFrame.corr is deprecated. In a future version, it will default to False. Select only valid columns or specify the value of numeric_only to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2-gather-and-explore-additional-modeling-data_files/figure-html/cell-35-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="time-series-of-complaint-count" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="time-series-of-complaint-count"><span class="header-section-number">6.2</span> Time series of complaint count</h3>
<p>Next, we plotted a time series heatmap of total complaint counts by “Week” and “Day of the Week” to further analyze the temporal patterns of trash-related complaints across NYC.</p>
<p>In line with our observations, complaint counts generally increase during warmer months (particularly in summer) compared to the beginning and end of the year. However, contrary to our initial expectations, there are generally more complaints on weekdays than on weekends. Nonetheless, the heatmap clearly indicates a generally consistent weekly pattern, with certain days showing higher complaint frequencies.</p>
<div id="4c37259f-9d26-434f-9a20-f83f8b24d331" class="cell" data-tags="[]" data-execution_count="35">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>day_order <span class="op">=</span> [<span class="st">'Sunday'</span>, <span class="st">'Monday'</span>, <span class="st">'Tuesday'</span>, <span class="st">'Wednesday'</span>, <span class="st">'Thursday'</span>, <span class="st">'Friday'</span>, <span class="st">'Saturday'</span>]</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>DSNY_final[<span class="st">'Day of Week'</span>] <span class="op">=</span> pd.Categorical(DSNY_final[<span class="st">'Day of Week'</span>], categories<span class="op">=</span>day_order, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>DSNY_final_heatmap <span class="op">=</span> DSNY_final.copy()</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>DSNY_final_heatmap[<span class="st">'Week'</span>] <span class="op">=</span> DSNY_final[<span class="st">'Week'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>heatmap_data <span class="op">=</span> DSNY_final_heatmap.pivot_table(</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'Week'</span>, columns<span class="op">=</span><span class="st">'Day of Week'</span>, values<span class="op">=</span><span class="st">'Complaint Count'</span>, aggfunc<span class="op">=</span><span class="st">'sum'</span>, fill_value<span class="op">=</span><span class="dv">0</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>sns.heatmap(</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    heatmap_data,</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'viridis'</span>, </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    annot<span class="op">=</span><span class="va">False</span>,    </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">=</span><span class="st">"d"</span>,         </span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    cbar<span class="op">=</span><span class="va">True</span>       </span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Heatmap of Complaint Counts by Day and Week of Year'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Day of Week'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Week'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2-gather-and-explore-additional-modeling-data_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="map-of-complaint-count-in-relation-to-highly-correlated-factors" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="map-of-complaint-count-in-relation-to-highly-correlated-factors"><span class="header-section-number">6.3</span> Map of Complaint Count in relation to highly-correlated factors</h3>
<section id="create-a-mapping-master-dataframe" class="level4" data-number="6.3.1">
<h4 data-number="6.3.1" class="anchored" data-anchor-id="create-a-mapping-master-dataframe"><span class="header-section-number">6.3.1</span> Create a Mapping Master Dataframe</h4>
<div id="843f122c-f7ba-4d59-89ee-8d62602682b2" class="cell" data-tags="[]" data-execution_count="36">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>DSNY_final_grouped <span class="op">=</span> DSNY_final.groupby(<span class="st">'DSNY_ID'</span>).agg({</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Complaint Count'</span>: <span class="st">'sum'</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Complaint Count Lag'</span>: <span class="st">'sum'</span>,         </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pct_Non_White'</span>: <span class="st">'mean'</span>,    </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pct_Hispanic'</span>: <span class="st">'mean'</span>,  </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Poverty_Rate'</span>: <span class="st">'mean'</span>,  </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Avg_HH_Size'</span>: <span class="st">'mean'</span>,  </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Restaurant Inspection Count'</span>: <span class="st">'sum'</span>,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Derelict Vehicle Count'</span>:<span class="st">'sum'</span>,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Basket Count'</span>: <span class="st">'mean'</span>      </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>DSNY_final_grouped.rename(columns<span class="op">=</span>{</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Complaint Count"</span>: <span class="st">"2023 Annual Total of Complaint Count"</span>,</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Complaint Count Lag"</span>: <span class="st">"2022 Annual Total of Complaint Count"</span>,</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Pct_Non_White"</span>: <span class="st">"2023 Share of Non-White Population"</span>,</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Pct_Hispanic"</span>: <span class="st">"2023 Share of Hispanic-Latino Population"</span>,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Poverty_Rate"</span>: <span class="st">"2023 Poverty Rate"</span>, </span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Avg_HH_Size"</span>: <span class="st">"2023 Average Household Size"</span>,</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Restaurant Inspection Count"</span>: <span class="st">"2023 Annual Total of Restaurant Inspection Count"</span>,</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Derelict Vehicle Count"</span>: <span class="st">"2023 Annual Total of Derelict Vehicle Count"</span>,</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Basket Count"</span>: <span class="st">"2023 Annual Total of Basket Count"</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="1e53646e-553d-479a-a612-f88e5da9f6fe" class="cell" data-tags="[]" data-execution_count="37">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>DSNY_final_grouped <span class="op">=</span> DSNY_final_grouped.merge(DSNY_boundary, on<span class="op">=</span><span class="st">"DSNY_ID"</span>, how<span class="op">=</span><span class="st">"right"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>DSNY_final_grouped <span class="op">=</span> gpd.GeoDataFrame(DSNY_final_grouped, geometry<span class="op">=</span>DSNY_final_grouped[<span class="st">'geometry'</span>], crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>DSNY_final_grouped <span class="op">=</span> DSNY_final_grouped.to_crs(DSNY_boundary.crs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mapping-dependent-and-independent-variables" class="level4" data-number="6.3.2">
<h4 data-number="6.3.2" class="anchored" data-anchor-id="mapping-dependent-and-independent-variables"><span class="header-section-number">6.3.2</span> Mapping Dependent and Independent Variables</h4>
<p>Then, we created a series of maps to visualize the spatial distribution of trash-related complaints with correlated variables. The following highlights are made:</p>
<ul>
<li>Spots with high complaint counts in 2023 is generally the same as that of 2022, with hotspots stretching all the way from south of the Central Park all the way to northern Brooklyn. This indicates that lagged complaint count is a powerful predictor of the next year’s pattern.</li>
<li>Whereas in other regions, complaint counts tend to correspond spatially with areas of lower non-white population share, lower Hispanic-Latino population share, and lower poverty rates, the Bronx Borough stands out as the only area where high complaint counts align with the opposite trends.</li>
<li>Higher complaint counts aligns with areas with smaller average households, likely due to density of development and increased ground traffic. High complaint counts also correspond with areas with a high frequency of restaurant inspections and denser litter basket placement. This likely reflects dense business development and human activity, as seen in areas such as Midtown Manhattan.</li>
<li>Complaints also tend to occur in areas with a high prevalence of derelict vehicles, except in the area spanning Midtown Manhattan to the southern tip of Manhattan, where complaints are less likely driven by a lack of management and more reflective of active business corridors.</li>
</ul>
<div id="8ceeb857-7f86-41c4-b91d-2e16f2e592a6" class="cell" data-execution_count="38">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> [<span class="st">"2023 Annual Total of Complaint Count"</span>, <span class="st">"2022 Annual Total of Complaint Count"</span>, <span class="st">"2023 Share of Non-White Population"</span>, <span class="st">"2023 Share of Hispanic-Latino Population"</span>,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">"2023 Poverty Rate"</span>, <span class="st">"2023 Average Household Size"</span>, <span class="st">"2023 Annual Total of Restaurant Inspection Count"</span>, <span class="st">"2023 Annual Total of Derelict Vehicle Count"</span>, </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">"2023 Annual Total of Basket Count"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="c7d8dce8-199b-436c-8a82-516f1810ea26" class="cell" data-tags="[]" data-execution_count="39">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>num_rows <span class="op">=</span> <span class="op">-</span>(<span class="op">-</span><span class="bu">len</span>(metrics) <span class="op">//</span> num_cols)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(num_rows, num_cols, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">5</span> <span class="op">*</span> num_rows)) </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot each metric</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, metric <span class="kw">in</span> <span class="bu">enumerate</span>(metrics):</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[i]</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    DSNY_final_grouped.plot(</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>        column<span class="op">=</span>metric, </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>        cmap<span class="op">=</span><span class="st">"viridis"</span>, </span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>        legend_kwds<span class="op">=</span>{</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'shrink'</span>: <span class="fl">0.5</span>,  </span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'location'</span>: <span class="st">'right'</span>, </span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'pad'</span>: <span class="fl">0.02</span>,</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'aspect'</span>: <span class="dv">20</span>   </span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"</span><span class="sc">{</span>metric<span class="sc">}</span><span class="ss"> in NYC"</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn off unused subplots</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(metrics), <span class="bu">len</span>(axes)):</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    fig.delaxes(axes[j])</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust layout</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2-gather-and-explore-additional-modeling-data_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="chart-of-complaint-count-with-natural-factors" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="chart-of-complaint-count-with-natural-factors"><span class="header-section-number">6.4</span> Chart of Complaint Count with Natural Factors</h3>
<p>Finally, we analyzed the relationship between trash-related complaints and daily temperature. Consistent with our observations from the time series heatmap, we found a positive correlation between higher complaint volumes and higher daily temperatures.</p>
<div id="7ca0a90a-632d-4e8f-8e46-3c715aee7cac" class="cell" data-tags="[]" data-execution_count="40">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>sns.regplot(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>DSNY_final,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'Complaint Count'</span>,        </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'avg_temp'</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    scatter_kws<span class="op">=</span>{<span class="st">'alpha'</span>: <span class="fl">0.5</span>},  </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'red'</span>},   </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    ci<span class="op">=</span><span class="dv">95</span>                       </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Complaint Count vs. Daily Temperature'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Complaint Count'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Daily Temperature (°F)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>Text(0, 0.5, 'Daily Temperature (°F)')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2-gather-and-explore-additional-modeling-data_files/figure-html/cell-41-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="save-data-for-model-building" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="save-data-for-model-building"><span class="header-section-number">7</span> Save Data for Model Building</h2>
<div id="34be74c1-6cb7-4aed-9069-12bbdb6dd5ff" class="cell" data-tags="[]" data-execution_count="41">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>DSNY_master <span class="op">=</span> DSNY_final.drop(columns<span class="op">=</span>[<span class="st">"geometry"</span>])</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>DSNY_master.to_parquet(<span class="st">'data/2_DSNY_master.parquet'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>xuyaohan99@gmail.com/nevezhang00@gmail.com</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This page is built with ❤️❤️❤️ and <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>